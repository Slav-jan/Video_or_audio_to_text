# ====================================================================
# –ë–õ–û–ö 2: –¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø –ó–ê–ì–†–£–ñ–ï–ù–ù–û–ì–û –ê–£–î–ò–û
# ====================================================================
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –ë–ª–æ–∫–µ 1 –±—ã–ª –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º download_and_transcribe = False

import whisper
import os

# –ß–∏—Ç–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞
try:
    with open("audio_settings.txt", "r") as f:
        lines = f.read().strip().split('\n')
        audio_filename = lines[0]
        audio_file = lines[1]
        txt_file = lines[2]
    
    print(f"üìÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:")
    print(f"üéµ –ò—â–µ–º –∞—É–¥–∏–æ—Ñ–∞–π–ª: {audio_file}")
    print(f"üìÑ –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: {txt_file}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
    if os.path.exists(audio_file):
        print(f"‚úÖ –ê—É–¥–∏–æ—Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: {audio_file}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
        !ls -lh "{audio_file}"
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å Whisper
        print("ü§ñ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å Whisper...")
        model = whisper.load_model("large")
        
        # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º –∞—É–¥–∏–æ
        print("üéôÔ∏è –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é...")
        result = model.transcribe(audio_file, fp16=False)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        with open(txt_file, "w", encoding="utf-8") as f:
            f.write(result["text"])
        
        print("‚úÖ –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
        print(f"üìÑ –¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: {txt_file}")
        print("\nüìù –ü–µ—Ä–≤—ã–µ 300 —Å–∏–º–≤–æ–ª–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:")
        print(result["text"][:300] + "..." if len(result["text"]) > 300 else result["text"])
        
    else:
        print(f"‚ùå –ê—É–¥–∏–æ—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {audio_file}")
        print("üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã:")
        print("   1. –ó–∞–≥—Ä—É–∑–∏–ª–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é")
        print(f"   2. –§–∞–π–ª –∏–º–µ–µ—Ç —Ç–æ—á–Ω–æ–µ –∏–º—è: {audio_file}")
        print("   3. –ó–∞–ø—É—Å—Ç–∏–ª–∏ –ë–ª–æ–∫ 1 —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π download_and_transcribe = False")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã
        print("\nüìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:")
        !ls -la *.mp3 *.wav *.m4a 2>/dev/null || echo "–ê—É–¥–∏–æ—Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

except FileNotFoundError:
    print("‚ùå –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    print("üí° –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ë–ª–æ–∫ 1 –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
    print("üí° –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ë–ª–æ–∫ 1 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏")
