# ====================================================================
# –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô –ú–ï–¢–û–î: –°–ö–ê–ß–ò–í–ê–ù–ò–ï –° YOUTUBE –ë–ï–ó –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô
# ====================================================================

# –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
!pip install --upgrade yt-dlp pytube

# 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é pytube
import pytube
import os
from pytube import YouTube

def download_with_pytube(url, filename):
    """–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ —Å –ø–æ–º–æ—â—å—é pytube"""
    try:
        print("üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º pytube –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...")
        yt = YouTube(url)
        
        # –ü–æ–ª—É—á–∞–µ–º –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫
        audio_stream = yt.streams.filter(only_audio=True).first()
        
        if audio_stream:
            # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            downloaded_file = audio_stream.download(filename=f"{filename}.mp4")
            
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ MP3
            mp3_file = f"{filename}.mp3"
            os.system(f"ffmpeg -i '{downloaded_file}' -vn -acodec mp3 '{mp3_file}'")
            
            # –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
            os.remove(downloaded_file)
            
            print(f"‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω: {mp3_file}")
            return True
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Å pytube: {e}")
        return False

# 3. –ú–µ—Ç–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
def download_with_proxy(url, filename):
    """–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏"""
    proxy_commands = [
        f'yt-dlp --proxy socks5://127.0.0.1:9050 -x --audio-format mp3 -o "{filename}.%(ext)s" "{url}"',
        f'yt-dlp --proxy http://proxy.example.com:8080 -x --audio-format mp3 -o "{filename}.%(ext)s" "{url}"'
    ]
    
    for cmd in proxy_commands:
        try:
            result = os.system(cmd)
            if result == 0:
                return True
        except:
            continue
    return False

# 4. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
def download_youtube_audio(url, filename):
    """–ü–æ–ø—ã—Ç–∫–∞ —Å–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏"""
    
    methods = [
        ("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π yt-dlp", lambda: os.system(f'yt-dlp -x --audio-format mp3 -o "{filename}.%(ext)s" "{url}") == 0),
        ("yt-dlp —Å Android –∫–ª–∏–µ–Ω—Ç–æ–º", lambda: os.system(f'yt-dlp --extractor-args "youtube:player_client=android" -x --audio-format mp3 -o "{filename}.%(ext)s" "{url}") == 0),
        ("yt-dlp —Å –≤–µ–± –∫–ª–∏–µ–Ω—Ç–æ–º", lambda: os.system(f'yt-dlp --extractor-args "youtube:player_client=web" -x --audio-format mp3 -o "{filename}.%(ext)s" "{url}") == 0),
        ("pytube", lambda: download_with_pytube(url, filename)),
    ]
    
    for method_name, method_func in methods:
        print(f"üîÑ –ü—Ä–æ–±—É–µ–º: {method_name}")
        try:
            if method_func():
                print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω–æ –º–µ—Ç–æ–¥–æ–º: {method_name}")
                return True
        except Exception as e:
            print(f"‚ùå {method_name} –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
    
    print("‚ùå –í—Å–µ –º–µ—Ç–æ–¥—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–µ—É–¥–∞—á–Ω—ã")
    return False

# ====================================================================
# –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
# ====================================================================

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
video_url = "https://www.youtube.com/watch?v=8kvMficZrIo"
filename = "–ü—É—Ç—å_–≤_DevOps_–ø–æ–ª–Ω–æ–µ_—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"

# –ü–æ–ø—ã—Ç–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
if download_youtube_audio(video_url, filename):
    print(f"üéµ –ê—É–¥–∏–æ—Ñ–∞–π–ª –≥–æ—Ç–æ–≤: {filename}.mp3")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª
    !ls -lh "{filename}.mp3"
    
    # –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
    print("‚ñ∂Ô∏è –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é")
else:
    print("üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
    print("1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ")
    print("2. –°–∫–∞—á–∞–π—Ç–µ –∞—É–¥–∏–æ –≤—Ä—É—á–Ω—É—é —Å –ø–æ–º–æ—â—å—é –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å–æ–≤")
    print("3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É")
    print("4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ - –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π")

# ====================================================================
# –†–£–ß–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–ê
# ====================================================================

print("\nüìÅ –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –†–£–ß–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò:")
print("1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å —Ñ–∞–π–ª–æ–≤ –≤ Google Colab")
print("2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤")
print("3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∞—É–¥–∏–æ—Ñ–∞–π–ª")
print("4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏")
print("5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ë–ª–æ–∫ 2 –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏")

# –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
from google.colab import files
print("\nüì§ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –≤–∏–¥–∂–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:")
print("–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:")
print("# uploaded = files.upload()")
